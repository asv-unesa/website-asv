<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>SEAHUNTER</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.7.0/fonts/remixicon.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=water"/>
    <link rel="stylesheet" href="style copy.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <!-- <link rel="preconnect" href="https://maps.google.com"> -->
    
    <style>
        /* Preloader styles */
        .preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 1s ease;
        }

        .preloader.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .preloader-content {
            text-align: center;
        }

        .preloader-logo {
            width: 175px;
            height: 175px;
            animation: rotate-scale 2s ease-in-out infinite;
        }

        .preloader-text {
            color: white;
            margin-top: 20px;
            font-size: 24px;
            opacity: 0;
            animation: fade-in 1s ease forwards;
        }

        @keyframes rotate-scale {
            0% {
                transform: rotate(0deg) scale(1);
            }
            50% {
                transform: rotate(180deg) scale(1.2);
            }
            100% {
                transform: rotate(360deg) scale(1);
            }
        }

        @keyframes fade-in {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .preloader-text-logo {
            display: block;
            width: 100%;
            font-weight: bold;
            font-size: 32px;
            color: #7f7f7f; /* Fixed missing # */
            margin: 5px;
            overflow: hidden;
        }

        .preloader-text-logo .run-text {
            display: inline-block;
            white-space: nowrap;
            transform: translateX(100%);
            animation: run-from-right 2s linear 1 forwards;
            color: black;
        }

        @keyframes run-from-right {
            0% {
                transform: translateX(-110%);
            }
            100% {
                transform: translateX(0%);
            }
        }

        /* Hide content initially */
        .main-content {
            opacity: 0;
            transition: opacity 1s ease;
        }

        .main-content.visible {
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Preloader -->
    <div class="preloader">
        <div class="preloader-content">
            <img src="Seahunter.png" alt="SEAHUNTER" class="preloader-logo" id="SEAHUNTER">
            <div class="preloader-text">SEAHUNTER</div>
            <h1 class="preloader-text-logo"><span class="run-text">SEAHUNTER 2025</span></h1>
        </div>
    </div>

    <!-- Main Header -->
    <header class="container-fluid text-center justify-content-center align-items-center py-2" style="background-color: blue;">
        <!-- <div class="Head align-items-center"> -->
        <div class="row g-xxl-5 d-flex align-items-center justify-content-center">
            <div class="col-2 py-1 d-flex justify-content-center">
                <img src="Logo_Universitas_Negeri_Surabaya_Terbaru.png" class="img-fluid rounded float-md-none"
                alt="Logo Universitas Negeri Surabaya" title="Logo Universitas Negeri Surabaya" id="Logo">
            </div>
            <div class="col-6 text-center pt-3">
                <div class="Tag"> 
                    <h1 class="Univ text-center" title="Satu Langkah di Depan!">UNIVERSITAS NEGERI SURABAYA</h1> 
                    <h1 class="Team text-center" title="Jaya Jaya Jaya JUARA!!!">SEAHUNTER</h1>
                </div>
            </div>
            <div class="col-2 py-1 d-flex justify-content-center">
                <img src="Logo_KEMENDIKTI.png" class="img-fluid rounded float-md-none"
                alt="Logo KEMENDIKTI" title="Logo KEMENDIKTI" id="Logo">
            </div>
        </div>
        <!-- </div> -->
    </header>

    <!-- Main Content -->
    <div class="main-content">
    <!-- Left/Position Log -->

    <div class="container-fluid bg-light">
        <div class="row"> <!--Row is horizontal, col is vertical-->
            <div class="col-md-3 p-3 order-1">
                <h2 class="m-3 border-start border-primary border-5 text-center">
                    <i class="ri-navigation-fill fw-bold me-2">Position Log</i>
                </h2>
                <div class="Details py-1">
                    <ul class="list-unstyled" id="position-log">
                        <li class="text m-4 p-3" tabindex="0" role="button">
                            <i class="ri-play-circle-fill me-2"></i>Preparation
                        </li>
                        <li class="text m-4 p-3" tabindex="0" role="button">
                            <i class="ri-rocket-fill me-2"></i>Start
                        </li>
                        <li class="text m-4 p-3" tabindex="0" role="button">
                            <i class="ri-bubble-chart-fill me-2"></i>Floating Ball
                        </li>
                        <li class="text m-4 p-3" tabindex="0" role="button">
                            <i class="ri-water-flash-fill me-2"></i>Surface
                        </li>
                        <li class="text m-4 p-3" tabindex="0" role="button">
                            <span class="material-symbols-outlined me-0">water</span>
                            <i class="ri-submarine-fill"></i>Underwater
                        </li>
                        <li class="text m-4 p-3" tabindex="0" role="button">
                            <i class="ri-flag-fill me-2"></i>Finish
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Mid/Image Processing -->
            <div class="col-md-4 p-3 order-2"> <!--Padding (p) is distance inside element, while Margin (m) distance outside element-->
                <h2 class="m-3 pb-2 text-center">
                    <i class="ri-multi-image-line fw-bold me-2">Image Processing</i>
                    <!-- <i class="ri-camera-ai-fill me-2">Image Processing</i> -->
                </h2>
                <div class="Mid text-center px-1">

                    <h2 class="Surface">
                        <i class="ri-water-flash-fill me-2">Surface</i>
                    </h2>
                    <div class="status-box p-3 m-2"> 
                        <!-- area gambar -->
                        <div class="text-center mb-2 mx-auto" style="min-height: 100px; max-height: 220px; max-width: 270px;">
                            <img id="surface-image" class="img-fluid rounded d-none" src="" alt="Surface Camera" 
                            style="object-fit: contain; width: 100%; height: 100%; max-height: 200px;">
                        </div>

                        <div class="d-flex justify-content-center gap-0 image-overlay-indicator">
                            <div class="status-box-indicator m-1 py-1 flex-fill" style="max-width: 90px;">
                                <!-- <i class="ri-speed-up-fill"></i> -->
                                <span class="h6 d-block fw-bold">SOG</span>
                                <span class="h4 text-muted" id="surface-sog">0.0 kts</span>
                            </div>
                            <div class="status-box-indicator m-1 py-1 flex-fill" style="max-width: 90px;">
                                <!-- <i class="ri-compass-3-fill"></i> -->
                                <span class="h6 d-block fw-bold">COG</span>
                                <span class="h4 text-muted" id="surface-cog">0°</span>
                            </div>
                            <div class="status-box-indicator m-1 p-1 flex-fill" style="max-width: 140px;">
                                <!-- <i class="ri-map-pin-fill"></i> -->
                                <span class="h6 d-block fw-bold">Position</span>
                                <span class="small text-muted" id="surface-pos">0.000°, 0.000°</span>
                            </div>
                        </div>
                    </div>

                    <h2 class="Underwater">
                        <span class="material-symbols-outlined me-0">water</span>
                        <i class="ri-submarine-fill me-2">Underwater</i>
                    </h2>
                    <div class="status-box p-3 m-2">
                        <!-- area gambar -->
                        <div class="text-center mb-2 mx-auto" style="min-height: 100px; max-height: 220px; max-width: 270px;">
                            <img id="underwater-image" class="img-fluid rounded d-none" src="" alt="Underwater Camera" 
                            style="object-fit: contain; width: 100%; height: 100%; max-height: 200px;">
                        </div>

                        <div class="d-flex justify-content-center gap-0 image-overlay-indicator">
                            <div class="status-box-indicator m-1 py-1 flex-fill" style="max-width: 90px;">
                                <!-- <i class="ri-speed-up-fill"></i> -->
                                <span class="h6 d-block fw-bold">SOG</span>
                                <span class="h4 text-muted" id="under-sog">0.0 kts</span>
                            </div>
                            <div class="status-box-indicator m-1 py-1 flex-fill" style="max-width: 90px;">
                                <!-- <i class="ri-compass-3-fill"></i> -->
                                <span class="h6 d-block fw-bold">COG</span>
                                <span class="h4 text-muted" id="under-cog">0°</span>
                            </div>
                            <div class="status-box-indicator m-1 p-1 flex-fill" style="max-width: 140px;">
                                <!-- <i class="ri-map-pin-fill"></i> -->
                                <span class="h6 d-block fw-bold">Position</span>
                                <span class="small text-muted" id="under-pos">0.000°, 0.000°</span>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Right/Map Trajectory -->
            <div class="col-md-5 p-3 order-3 d-flex flex-column">
                <h2 class="m-3 text-center">
                    <i class="ri-map-2-fill fw-bold me-2">Map Trajectory</i>
                </h2>
                <div class="Right p-3 flex-grow-1 d-flex flex-column">
                    <div class="map text-center align-content-center flex-grow-1 d-flex flex-column">
                        <div id="date" class="m-3"></div>
                        <div class="row full-height flex-grow-1">
                        <!-- Map on the right -->
                            <div class="col">
                                <div class="map-container ms-4 justify-content-center align-items-center align-content-center">
                                <!-- This contains map -->
                                    <div id="map" style="width:100%; height:100%; border:none;" loading="Lazy";
                                    title="Map showing location" class="map-tracker"></div>
                                    
                                    <div class="compass-container">
                                        <div class="compass">
                                            <div class="compass-arrow"></div>
                                            <div class="compass-direction compass-n">N</div>
                                            <div class="compass-direction compass-e">E</div>
                                            <div class="compass-direction compass-s">S</div>
                                            <div class="compass-direction compass-w">W</div>
                                            <div class="compass-center"></div>
                                        </div>
                                    </div>

                                    <!-- Overlay indicator -->
                                    <div class="map-overlay d-flex justify-content-center gap-0">
                                        <div class="status-box-indicator-map m-1 py-1 flex-fill" style="max-width: 50px;">
                                            <span class="h6 d-block fw-bold">SOG</span>
                                            <span class="h4 text-muted">0.0 kts</span>
                                        </div>
                                        <div class="status-box-indicator-map m-1 py-1 flex-fill" style="max-width: 50px;">
                                            <span class="h6 d-block fw-bold">COG</span>
                                            <span class="h4 text-muted">0°</span>
                                        </div>
                                        <div class="status-box-indicator-map m-1 p-1 flex-fill" style="max-width: 70px;">
                                            <span class="h6 d-block fw-bold">Position</span>
                                            <span class="small text-muted">0.000°, 0.000°</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between mt-3">
                        <div class="camera-indicator p-2 flex-fill me-2">
                            <i class="ri-settings-3-fill"></i>
                            <span class="h6 d-block fw-bold">Mode</span>
                            <span class="small text-muted" id="mode">Auto</span>
                        </div>
                        <div class="mode-indicator p-2 flex-fill">
                            <i class="ri-video-on-line"></i>
                            <span class="h6 d-block fw-bold">Camera</span>
                            <span class="small text-muted" id="camera">Idle</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    </div> <!-- Close main-content -->

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://rawcdn.githack.com/bbecquet/Leaflet.RotatedMarker/master/leaflet.rotatedMarker.js"></script>

    <!-- Script map improvment -->
    <script src= "map.js" ></script>

    <!-- Custom Scripts -->
    <script>
        // Improved clock function with performance optimization
        function updateClock() {
            const clockElement = document.getElementById("clock");
            // get element by ID and set innerHTML
            const dateElement = document.getElementById("date");

            // Date script
            const Day = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
            const Month = ["January", "February", "March", "April", "May", "June", "July",
            "August", "September", "October", "November", "December"];

            function update() {
                const now = new Date();

                //Clock
                const timeString = now.toLocaleTimeString(undefined, {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });

                // get today's date
                const day = Day[now.getDay()];
                const date = now.getDate();
                const month = Month[now.getMonth()];
                const year = now.getFullYear();
                const dateString = `${day}, ${date} ${month} ${year} | ${timeString}`;

                if (clockElement) clockElement.textContent = timeString;
                if (dateElement) dateElement.textContent = dateString;
            }

            update();
            setInterval(update, 1000);
        }

        // Initialize clock
        document.addEventListener("DOMContentLoaded", updateClock);

        // // Add smooth transitions for status boxes
        // document.addEventListener('DOMContentLoaded', () => {
        //     document.querySelectorAll('.status-box', '.status-box-indicator').forEach(el => {
        //         el.addEventListener('mouseover', () => {
        //             el.style.transform = 'translateY(-5px)';
        //         });
        //         box.addEventListener('mouseout', () => {
        //             box.style.transform = 'translateY(0)';
        //         });
        //     });
        // });

        // Lazy load map-tracker
        // document.addEventListener('DOMContentLoaded', () => {
        //     const mapFrame = document.querySelector('.map-container .map-tracker');
        //     if (mapFrame) {
        //         mapFrame.loading = 'lazy';
        //     }
        // });

        // Preloader optimization
        window.addEventListener('load', () => {
            const preloader = document.querySelector('.preloader');
            const mainContent = document.querySelector('.main-content');
            const runText = document.querySelector('.preloader-text-logo .run-text');
            
            const finishPreloader = () => {
                if (!preloader || !mainContent) return;
                preloader.classList.add('fade-out');
                mainContent.classList.add('visible');

                // Remove from DOM after animation for better performance
                setTimeout(() => {
                    preloader.remove();
                }, 1000);
            };

            if (runText) {
                runText.addEventListener('animationend', finishPreloader, {once: true});
                setTimeout(finishPreloader, 2200); // Fallback
            } else {
                setTimeout(finishPreloader, 2000);
            }
        });

        // Set active position in position log
        function setActivePosition(positionName){
            const items = document.querySelectorAll('#position-log li.text[role="button"]');
            let targetItem = null;

            //Cari berdasarkan teks
            items.forEach(el => {
                const textContent = el.textContent.trim().toLowerCase();
                if (textContent.includes(positionName.toLowerCase())) {
                    targetItem = el;
                }
            });
            
            // if (!targetItem) {
            //     console.warn(`Position "${positionName}" tidak ditemukan di daftar.`);
            //     return;
            // }

            items.forEach(el => el.classList.remove('active'));

            if (targetItem) {
                targetItem.classList.add('active');
            } else {
                console.warn(`Can not find Position "${positionName}".`);
            }

            // If it is active, then turn off (Toggle active state must be uncommented)
            // if (targetItem.classList.contains('active')) {
            //     targetItem.classList.remove('active');
            // } else {
            //     //Hapus active dari semua item lain
            //     items.forEach(el => el.classList.remove('active'));
            //     // aktifkan target
            //     targetItem.classList.add('active');
            // }
        }

        // Set active position in position log on click (Optional: Toggle active state)
        // document.addEventListener('DOMContentLoaded', () => {
        //     // Add click handlers for position log items
        //     document.querySelectorAll('.text[role="button"]').forEach(item => {
        //         item.addEventListener('click', () => {
        //         setActivePosition(item.textContent.trim());
        //         });
        //     });
        // });

        // Position Log Logic
        document.addEventListener('DOMContentLoaded', () => {
            setActivePosition('Preparation');
        })
        function onStart() {
            console.log('Starting...');
            setActivePosition('Start');
        }
        function onFloatingBall() {
            console.log('Floating Ball...');
            setActivePosition('Floating Ball');
        }
        function onSurface() {
            console.log('Surface...');
            setActivePosition('Surface');
        }
        function onUnderwater() {
            console.log('Underwater...');
            setActivePosition('Underwater');
        }
        function onFinish() {
            console.log('Finish...');
            setActivePosition('Finish');
        }

        // Dummy sequence to demonstrate position log updates
        // setTimeout(() => onStart(), 2000);
        // setTimeout(() => onFloatingBall(), 4000);
        // setTimeout(() => onSurface(), 6000);
        // setTimeout(() => onUnderwater(), 8000);
        // setTimeout(() => onFinish(), 10000);

        // Dummy load images
        let surfaceImgae = document.getElementById('surface-image');
            surfaceImgae.src = '/website-asv/Seahunter.png';
            surfaceImgae.classList.remove('d-none');
        let underwaterImage = document.getElementById('underwater-image');
            underwaterImage.src = '/website-asv/ship.png';
            underwaterImage.classList.remove('d-none');

        // Kamera
        function updateCameraStatus(status) {
            const cameraElement = document.getElementById("camera");
            if (cameraElement) {
                cameraElement.textContent = status;
            } else {
                console.warn("Error: ID 'camera' is not found.");
            }
        }

        async function fetchCameraStatus() {
            try {
                const response = await fetch('/api/camera'); // Change with your actual API endpoint
                if (!response.ok) {
                    throw new Error('Camera API request failed');
                }
                const data = await response.json();
                updateCameraStatus(data.status);
            } catch (error) {
                console.error('Error fetching camera status:', error);
            }
        }
        setInterval(fetchCameraStatus, 2000);
    </script>
</body>
</html>
